<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>レトロ時報時計</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: 'Courier New', Courier, monospace;
    }

    .clock-container {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.85);
      padding: 12px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      text-align: center;
      width: max-content;
    }

    #date {
      font-size: 20px;
      color: #222;
      margin-bottom: 6px;
      letter-spacing: 1px;
    }

    #clock {
      font-size: 40px;
      font-weight: bold;
      color: #111;
    }

    .jst {
      font-size: 16px;
      vertical-align: middle;
      margin-left: 8px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="clock-container">
    <div id="date">Loading...</div>
    <div id="clock">--:--:--</div>
  </div>

  <script>
    let offset = 0;

    // JSTの日本標準時を取得してローカル時間との差分を計算
    fetch('https://ntp-a1.nict.go.jp/cgi-bin/json')
      .then(response => response.json())
      .then(data => {
        const jstTime = new Date(data.st * 1000);
        offset = jstTime - Date.now();
      })
      .catch(err => console.error('時刻取得失敗:', err));

    // 時計表示を更新
    function updateClock() {
      const now = new Date(Date.now() + offset);
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, '0');
      const d = String(now.getDate()).padStart(2, '0');
      const dayOfWeek = ['日','月','火','水','木','金','土'][now.getDay()];
      const h = String(now.getHours()).padStart(2, '0');
      const min = String(now.getMinutes()).padStart(2, '0');
      const s = String(now.getSeconds()).padStart(2, '0');

      document.getElementById('date').textContent = `${y}年${m}月${d}日（${dayOfWeek}）`;
      document.getElementById('clock').innerHTML = `${h}:${min}:${s} <span class="jst">JST</span>`;

      if (min === '00' && s === '00') {
        playChime();
      }
    }

    // ピッ音生成
    function playBeep(freq = 880, duration = 0.2) {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();

      osc.type = 'sine';
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0.1, ctx.currentTime);

      osc.connect(gain);
      gain.connect(ctx.destination);

      osc.start();
      osc.stop(ctx.currentTime + duration);
    }

    // ピッ…ピッ…ポーンの3音時報
    function playChime() {
      playBeep(880, 0.2);               // ピッ
      setTimeout(() => playBeep(880, 0.2), 1000); // ピッ
      setTimeout(() => playBeep(660, 0.6), 2000); // ポーン
    }

    setInterval(updateClock, 1000);
    updateClock(); // 初回即実行
  </script>
</body>
</html>
